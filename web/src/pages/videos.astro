---
/**
 * Videos Page
 *
 * Displays the complete video gallery using the VideoGallery component.
 * Fetches videos directly from YouTube API instead of content collection.
 *
 * Features:
 * - Live data from YouTube channel
 * - Automatic sorting by publish date (newest first)
 * - Responsive grid layout (3 columns → 2 → 1)
 * - SEO optimized with meta tags
 * - Static HTML with interactive gallery (client:load)
 * - Mobile-optimized spacing and typography
 * - Dark mode support via semantic tokens
 * - Accessible with proper heading hierarchy
 *
 * Environment variables required:
 * - YOUTUBE_API_KEY: YouTube Data API v3 key
 * - YOUTUBE_CHANNEL_ID: Your YouTube channel ID
 *
 * Responsive breakpoints:
 * - Mobile (<768px): Single column, compact spacing
 * - Tablet (768-1024px): 2 columns, balanced layout
 * - Desktop (>1024px): 3 columns, spacious grid
 */

import { VideoGallery } from "@/components/media/VideoGallery";
import Layout from "@/layouts/Layout.astro";
import { fetchYouTubeVideos } from "@/services/youtube";

// Get YouTube API credentials from environment
const YOUTUBE_API_KEY = import.meta.env.YOUTUBE_API_KEY;
const YOUTUBE_CHANNEL_ID = import.meta.env.YOUTUBE_CHANNEL_ID;

let videoData = [];
let errorMessage = "";

// Fetch videos from YouTube API
if (!YOUTUBE_API_KEY || !YOUTUBE_CHANNEL_ID) {
	errorMessage =
		"YouTube API credentials not configured. Please set YOUTUBE_API_KEY and YOUTUBE_CHANNEL_ID in your .env file.";
	console.error(errorMessage);
} else {
	try {
		const youtubeVideos = await fetchYouTubeVideos(
			YOUTUBE_API_KEY,
			YOUTUBE_CHANNEL_ID,
			50,
		);

		// Transform YouTube data for VideoGallery component
		videoData = youtubeVideos.map((v) => ({
			title: v.title,
			description: v.description,
			thumbnail: v.thumbnail,
			duration: v.duration,
			slug: v.id, // Use YouTube ID as slug
			author: v.channelTitle,
			publishedAt: v.publishedAt,
			youtubeId: v.id, // YouTube video ID
			viewCount: v.viewCount,
			likeCount: v.likeCount,
		}));
	} catch (error) {
		errorMessage = `Error fetching videos from YouTube: ${error instanceof Error ? error.message : "Unknown error"}`;
		console.error(errorMessage);
	}
}

// Page metadata
const pageTitle = "Videos - ONE Platform";
const pageDescription =
	"Explore our collection of video tutorials, guides, and insights about blockchain technology, Sui, Web3, and the ONE Platform.";
---

<Layout
  title={pageTitle}
  description={pageDescription}
  sidebarInitialCollapsed={false}
>
  <!-- Page Container - responsive padding and max-width -->
  <div class="container mx-auto py-6 sm:py-8 lg:py-12 px-4 sm:px-6 lg:px-8 max-w-7xl">
    <!-- Page Header - responsive typography -->
    <header class="mb-6 sm:mb-8 lg:mb-10 space-y-3 sm:space-y-4">
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold tracking-tight">
        Videos
      </h1>
      <p class="text-base sm:text-lg text-muted-foreground max-w-2xl leading-relaxed">
        Discover in-depth video content covering blockchain development,
        Sui ecosystem updates, market analysis, and platform tutorials.
      </p>
    </header>

    <!-- Error Message - if API credentials not configured -->
    {errorMessage && (
      <div class="mb-6 sm:mb-8 p-4 sm:p-6 bg-destructive/10 border border-destructive rounded-lg">
        <h2 class="text-lg font-semibold text-destructive mb-2">Configuration Required</h2>
        <p class="text-sm text-muted-foreground mb-4">{errorMessage}</p>
        <div class="bg-muted/50 p-4 rounded border text-sm">
          <p class="font-mono mb-2">Add to your .env file:</p>
          <pre class="font-mono text-xs">YOUTUBE_API_KEY=your_api_key_here
YOUTUBE_CHANNEL_ID=your_channel_id_here</pre>
        </div>
      </div>
    )}

    <!-- Stats Banner - responsive sizing and spacing -->
    {videoData.length > 0 && (
      <div class="mb-6 sm:mb-8 p-3 sm:p-4 bg-muted/50 rounded-lg border">
        <p class="text-sm sm:text-base text-muted-foreground">
          <span class="font-semibold text-foreground">{videoData.length}</span>
          {videoData.length === 1 ? ' video' : ' videos'} available
        </p>
      </div>
    )}

    <!-- Video Gallery Component - static rendering, no client directive needed -->
    {videoData.length > 0 ? (
      <VideoGallery
        videos={videoData}
      />
    ) : !errorMessage && (
      <div class="text-center py-12">
        <p class="text-muted-foreground">No videos found.</p>
      </div>
    )}

    <!-- Back to top button - touch-friendly on mobile -->
    {videoData.length > 6 && (
      <div class="mt-8 sm:mt-12 flex justify-center">
        <button
          onclick="window.scrollTo({ top: 0, behavior: 'smooth' })"
          class="px-4 py-2 sm:px-6 sm:py-3 rounded-lg bg-muted hover:bg-muted/80 text-sm sm:text-base font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 touch-manipulation"
          aria-label="Scroll to top"
        >
          Back to top
        </button>
      </div>
    )}
  </div>
</Layout>
