---
/**
 * Performance Analytics Page
 *
 * Displays comprehensive performance metrics including:
 * - Core Web Vitals (LCP, FID, CLS)
 * - Lighthouse-style performance score
 * - Resource breakdown
 * - Performance issues and recommendations
 * - Performance budget tracking
 */

import Layout from '@/layouts/Layout.astro';
import { PerformanceMetrics } from '@/components/analytics/PerformanceMetrics';

const title = 'Performance Analytics';
const description = 'Monitor Core Web Vitals and page performance metrics';
---

<Layout title={title} description={description}>
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-4xl font-bold mb-2">Performance Analytics</h1>
      <p class="text-muted-foreground text-lg">
        Real-time monitoring of Core Web Vitals and page performance metrics
      </p>
    </div>

    <!-- Performance Dashboard -->
    <PerformanceMetrics client:load refreshInterval={5000} detailed={true} />

    <!-- How to Improve Section -->
    <div class="mt-8 grid gap-6 md:grid-cols-2">
      <div class="rounded-lg border p-6">
        <h2 class="text-2xl font-bold mb-4">Understanding the Metrics</h2>

        <div class="space-y-4">
          <div>
            <h3 class="font-semibold">Largest Contentful Paint (LCP)</h3>
            <p class="text-sm text-muted-foreground">
              Measures loading performance. To provide a good user experience, LCP should occur within 2.5 seconds.
            </p>
          </div>

          <div>
            <h3 class="font-semibold">First Input Delay (FID)</h3>
            <p class="text-sm text-muted-foreground">
              Measures interactivity. Pages should have an FID of 100 milliseconds or less.
            </p>
          </div>

          <div>
            <h3 class="font-semibold">Cumulative Layout Shift (CLS)</h3>
            <p class="text-sm text-muted-foreground">
              Measures visual stability. Pages should maintain a CLS of 0.1 or less.
            </p>
          </div>

          <div>
            <h3 class="font-semibold">Performance Score</h3>
            <p class="text-sm text-muted-foreground">
              A weighted average of all metrics. 90+ is excellent, 50-89 needs improvement, below 50 is poor.
            </p>
          </div>
        </div>
      </div>

      <div class="rounded-lg border p-6">
        <h2 class="text-2xl font-bold mb-4">Quick Wins</h2>

        <ul class="space-y-3">
          <li class="flex items-start gap-2">
            <span class="text-primary font-bold">1.</span>
            <div>
              <p class="font-semibold">Optimize Images</p>
              <p class="text-sm text-muted-foreground">
                Convert to WebP/AVIF, add lazy loading, use responsive images
              </p>
            </div>
          </li>

          <li class="flex items-start gap-2">
            <span class="text-primary font-bold">2.</span>
            <div>
              <p class="font-semibold">Reduce JavaScript</p>
              <p class="text-sm text-muted-foreground">
                Use code splitting, defer non-critical scripts, remove unused code
              </p>
            </div>
          </li>

          <li class="flex items-start gap-2">
            <span class="text-primary font-bold">3.</span>
            <div>
              <p class="font-semibold">Enable Caching</p>
              <p class="text-sm text-muted-foreground">
                Set proper cache headers, use CDN, implement service worker
              </p>
            </div>
          </li>

          <li class="flex items-start gap-2">
            <span class="text-primary font-bold">4.</span>
            <div>
              <p class="font-semibold">Minimize Layout Shifts</p>
              <p class="text-sm text-muted-foreground">
                Add width/height to images, reserve space for ads, use CSS aspect-ratio
              </p>
            </div>
          </li>

          <li class="flex items-start gap-2">
            <span class="text-primary font-bold">5.</span>
            <div>
              <p class="font-semibold">Use a CDN</p>
              <p class="text-sm text-muted-foreground">
                Serve assets from edge locations, reduce latency, improve TTFB
              </p>
            </div>
          </li>
        </ul>
      </div>
    </div>

    <!-- Technical Details -->
    <div class="mt-8 rounded-lg border p-6">
      <h2 class="text-2xl font-bold mb-4">Implementation Details</h2>

      <div class="grid gap-6 md:grid-cols-3">
        <div>
          <h3 class="font-semibold mb-2">Image Optimization</h3>
          <pre class="text-xs bg-muted p-3 rounded overflow-x-auto"><code>import &#123; generateResponsiveSources &#125; from '@/lib/performance/image-optimizer';

const optimized = generateResponsiveSources(
  '/image.jpg',
  &#123;
    widths: [640, 768, 1024],
    format: 'webp',
    quality: 85,
    lazy: true
  &#125;
);</code></pre>
        </div>

        <div>
          <h3 class="font-semibold mb-2">Performance Monitoring</h3>
          <pre class="text-xs bg-muted p-3 rounded overflow-x-auto"><code>import &#123; monitorPerformance &#125; from '@/lib/performance/performance-analyzer';

monitorPerformance((report) => &#123;
  console.log('Score:', report.score);
  console.log('LCP:', report.metrics.lcp);
  console.log('Issues:', report.issues);
&#125;);</code></pre>
        </div>

        <div>
          <h3 class="font-semibold mb-2">Custom Tracking</h3>
          <pre class="text-xs bg-muted p-3 rounded overflow-x-auto"><code>import &#123; getPerformanceAnalyzer &#125; from '@/lib/performance/performance-analyzer';

const analyzer = getPerformanceAnalyzer();

analyzer.mark('feature-start');
// ... code to measure ...
analyzer.mark('feature-end');

const duration = analyzer.measure(
  'feature-duration',
  'feature-start',
  'feature-end'
);</code></pre>
        </div>
      </div>
    </div>
  </div>
</Layout>
