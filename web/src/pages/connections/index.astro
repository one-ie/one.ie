---
import { getCollection } from "astro:content";
import {
	ArrowRight,
	Bot,
	DollarSign,
	Layers,
	Link2,
	MessageSquare,
	Search,
	Wallet,
} from "lucide-react";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import {
	Card,
	CardContent,
	CardDescription,
	CardHeader,
	CardTitle,
} from "@/components/ui/card";
import Layout from "../../layouts/Layout.astro";

// Get all connections
const connections = await getCollection("connections");
const sortedConnections = connections.sort((a, b) => {
	const protocolOrder = ["acp", "mcp", "a2a", "ap2", "x402", "agui"];
	const aIndex = protocolOrder.indexOf(a.data.protocol);
	const bIndex = protocolOrder.indexOf(b.data.protocol);
	return aIndex - bIndex;
});

const protocolIcons = {
	acp: MessageSquare,
	mcp: Layers,
	a2a: Bot,
	ap2: DollarSign,
	x402: Wallet,
	agui: Link2,
};

const protocolColors = {
	acp: "text-blue-500",
	mcp: "text-purple-500",
	a2a: "text-cyan-500",
	ap2: "text-amber-500",
	x402: "text-green-500",
	agui: "text-pink-500",
};
---

<Layout title="Connections - Protocol Documentation | ONE Platform">
  <!-- Hero Section -->
  <section class="relative overflow-hidden px-4 py-20 sm:px-6 sm:py-24 md:px-8 md:py-32">
    <div class="absolute inset-0 -z-10">
      <div class="absolute inset-0 bg-gradient-to-b from-background via-primary/5 to-background"></div>
    </div>

    <div class="mx-auto max-w-full sm:max-w-6xl space-y-8 text-center">
      <div class="inline-flex items-center gap-2 rounded-full border border-border/50 bg-card/50 px-4 py-2 backdrop-blur">
        <Search className="h-4 w-4 text-primary" />
        <span class="text-sm font-medium">Protocol Documentation</span>
      </div>

      <h1 class="text-5xl font-bold leading-tight tracking-tight sm:text-6xl md:text-7xl">
        Explore the
        <span class="relative inline-grid justify-center">
          <span class="col-start-1 row-start-1 text-[hsl(var(--primary))]">Six Protocols</span>
          <span
            aria-hidden="true"
            class="col-start-1 row-start-1 gradient-text"
          >
            Six Protocols
          </span>
        </span>
      </h1>

      <p class="mx-auto max-w-3xl text-xl leading-relaxed text-muted-foreground">
        Deep dive into each protocol. Learn how they map to the ontology, explore use cases, and find code examples.
      </p>

      <a href="/connections-landing#protocols">
        <Button size="lg" className="h-14 px-8 text-lg">
          Back to Overview
          <ArrowRight className="ml-2 h-5 w-5" />
        </Button>
      </a>
    </div>
  </section>

  <!-- Protocols Grid -->
  <section class="border-y bg-muted/50 px-4 py-20 sm:px-6 sm:py-24 md:px-8 md:py-32">
    <div class="mx-auto max-w-full sm:max-w-6xl">
      <div class="mb-20 space-y-4 text-center">
        <h2 class="text-4xl font-bold leading-tight tracking-tight sm:text-5xl">
          Protocol Specifications
        </h2>
        <p class="mx-auto max-w-3xl text-lg leading-relaxed text-muted-foreground">
          Click on any protocol to view detailed documentation, ontology mapping, use cases, and code examples.
        </p>
      </div>

      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {sortedConnections.map((connection) => {
          const Icon = protocolIcons[connection.data.protocol as keyof typeof protocolIcons] || MessageSquare;
          const colorClass = protocolColors[connection.data.protocol as keyof typeof protocolColors] || 'text-primary';

          return (
            <a href={`/connections/${connection.slug}`}>
              <Card className="group border-border/50 bg-card/50 backdrop-blur transition-all hover:scale-[1.02] hover:border-primary/20 hover:bg-card hover:shadow-lg hover:shadow-primary/5 h-full">
                <CardHeader className="space-y-4">
                  <div class="flex h-12 w-12 items-center justify-center rounded-lg bg-primary/10 transition-colors group-hover:bg-primary/15">
                    <Icon className={`h-6 w-6 ${colorClass}`} />
                  </div>
                  <div class="space-y-2">
                    <div class="flex items-center justify-between">
                      <CardTitle className="text-xl">{connection.data.protocol.toUpperCase()}</CardTitle>
                      {connection.data.category && (
                        <Badge variant="secondary" className="text-xs capitalize">
                          {connection.data.category}
                        </Badge>
                      )}
                    </div>
                    <div class="text-sm font-medium text-muted-foreground">{connection.data.title}</div>
                  </div>
                  <CardDescription className="leading-relaxed">
                    {connection.data.description}
                  </CardDescription>
                  {connection.data.organization && (
                    <div class="flex flex-wrap gap-2 pt-2">
                      <Badge variant="outline" className="text-xs">
                        {connection.data.organization}
                      </Badge>
                    </div>
                  )}
                </CardHeader>
              </Card>
            </a>
          );
        })}
      </div>
    </div>
  </section>

  <!-- Features Matrix -->
  <section class="px-4 py-20 sm:px-6 sm:py-24 md:px-8 md:py-32">
    <div class="mx-auto max-w-full sm:max-w-6xl">
      <div class="mb-20 space-y-4 text-center">
        <h2 class="text-4xl font-bold leading-tight tracking-tight sm:text-5xl">
          Protocol Comparison
        </h2>
        <p class="mx-auto max-w-3xl text-lg leading-relaxed text-muted-foreground">
          Choose the right protocol for your use case
        </p>
      </div>

      <div class="overflow-x-auto rounded-lg border border-border/50 bg-card/50 backdrop-blur">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-border/50">
              <th class="px-6 py-4 text-left font-semibold">Protocol</th>
              <th class="px-6 py-4 text-left font-semibold">Category</th>
              <th class="px-6 py-4 text-left font-semibold">Organization</th>
              <th class="px-6 py-4 text-left font-semibold">Status</th>
              <th class="px-6 py-4 text-center font-semibold">View</th>
            </tr>
          </thead>
          <tbody>
            {sortedConnections.map((connection) => (
              <tr class="border-b border-border/50 hover:bg-muted/50 transition-colors">
                <td class="px-6 py-4">
                  <div class="flex items-center gap-2">
                    <Badge variant="secondary">{connection.data.protocol.toUpperCase()}</Badge>
                    <span class="font-medium">{connection.data.title}</span>
                  </div>
                </td>
                <td class="px-6 py-4">
                  {connection.data.category && (
                    <Badge variant="outline" className="capitalize">
                      {connection.data.category}
                    </Badge>
                  )}
                </td>
                <td class="px-6 py-4 text-muted-foreground">
                  {connection.data.organization || 'â€”'}
                </td>
                <td class="px-6 py-4">
                  {connection.data.specification?.status && (
                    <Badge variant={connection.data.specification.status === 'stable' ? 'default' : 'secondary'}>
                      {connection.data.specification.status}
                    </Badge>
                  )}
                </td>
                <td class="px-6 py-4 text-center">
                  <a href={`/connections/${connection.slug}`} class="text-primary hover:underline">
                    <ArrowRight className="h-4 w-4 inline" />
                  </a>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  </section>
</Layout>
