---
/**
 * Collections Index Page with Sidebar Filters
 * Browse all product collections with filtering capabilities
 */

import Layout from '@/layouts/Layout.astro';
import { getCollection } from 'astro:content';
import CollectionPageClient from '@/components/ecommerce/interactive/CollectionPageClient';

// Get all collections and products
const allCollections = await getCollection('collections');
const allProducts = await getCollection('products');

// Transform product helper
const products = allProducts.map((p) => ({
  id: p.id,
  slug: p.slug,
  name: p.data.name,
  description: p.data.description,
  price: p.data.price,
  compareAtPrice: p.data.compareAtPrice,
  images: p.data.images,
  thumbnail: p.data.images[0],
  category: p.data.category,
  tags: p.data.tags || [],
  inStock: p.data.inStock,
  rating: 4.5,
  reviewCount: 0,
  featured: p.data.featured,
  createdAt: new Date(),
  updatedAt: new Date(),
}));

// Collections with associated products (used for filtering)
const collectionCategories = allCollections.map((collection) => ({
  id: collection.slug,
  name: collection.data.name,
  count: collection.data.products?.length || 0,
  products: collection.data.products ?? [],
}));

// Unique tags aggregated from products
const tags = Array.from(new Set(allProducts.flatMap((product) => product.data.tags || [])));

// Serialize products for client hydration
const productsForClient = products.map((product) => ({
  ...product,
  createdAt: product.createdAt.toISOString(),
  updatedAt: product.updatedAt.toISOString(),
}));
---

<Layout
  title="Collections - Browse All Categories"
  description="Explore all product collections"
  sidebarInitialCollapsed
>
  <div class="min-h-screen bg-background">
    <!-- Hero Section -->
    <section class="relative overflow-hidden bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 py-16 md:py-20">
      <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=1920')] bg-cover bg-center opacity-20"></div>
      <div class="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,.02)_1px,transparent_1px)] bg-[size:64px_64px]"></div>

      <div class="container relative mx-auto px-4">
        <div class="max-w-3xl mx-auto text-center">
          <h1 class="text-4xl font-black text-white md:text-5xl lg:text-6xl mb-4">
            All Collections
          </h1>
          <p class="text-lg text-white/80 md:text-xl">
            Explore our curated collections of premium products. Find exactly what you need.
          </p>
        </div>
      </div>
    </section>

    <!-- Main Content -->
    <section class="py-12 md:py-16">
      <div class="container mx-auto px-4">
        <CollectionPageClient
          client:load
          products={productsForClient}
          categories={collectionCategories}
          tags={tags}
          currentCollectionSlug="all"
        />
      </div>
    </section>
  </div>
</Layout>
