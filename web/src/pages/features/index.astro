---
import { getCollection } from "astro:content";
import { AlertCircle, CheckCircle2, Clock, Zap } from "lucide-react";
import { FeatureCard } from "@/components/features/FeatureCard";
import { FeatureCategoryFilter } from "@/components/features/FeatureCategoryFilter";
import { FeatureStats } from "@/components/features/FeatureStats";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import Layout from "../../layouts/Layout.astro";

// Get all features
const features = await getCollection("features");
const sortedFeatures = features.sort((a, b) => {
	// Sort by status priority then by name
	const statusOrder = [
		"completed",
		"beta",
		"in_development",
		"planned",
		"deprecated",
	];
	const aIndex = statusOrder.indexOf(a.data.status);
	const bIndex = statusOrder.indexOf(b.data.status);
	if (aIndex !== bIndex) return aIndex - bIndex;
	return a.data.title.localeCompare(b.data.title);
});

// Group features by status
const completedFeatures = sortedFeatures.filter(
	(f) => f.data.status === "completed",
);
const inDevelopmentFeatures = sortedFeatures.filter(
	(f) => f.data.status === "in_development" || f.data.status === "beta",
);
const plannedFeatures = sortedFeatures.filter(
	(f) => f.data.status === "planned",
);
---

<Layout title="Features - ONE Platform | Complete Platform Specification">
  <!-- Hero Section -->
  <section class="relative overflow-hidden px-4 py-20 sm:px-6 sm:py-24 md:px-8 md:py-32">
    <div class="absolute inset-0 -z-10">
      <div class="absolute inset-0 bg-gradient-to-b from-background via-primary/5 to-background"></div>
    </div>

    <div class="mx-auto max-w-6xl space-y-8 text-center">
      <div class="inline-flex items-center gap-2 rounded-full border border-border/50 bg-background/50 px-4 py-2 backdrop-blur">
        <Zap className="h-4 w-4 text-primary" />
        <span class="text-sm font-medium">Platform Features</span>
      </div>

      <h1 class="text-5xl font-bold leading-tight tracking-tight sm:text-6xl md:text-7xl">
        Complete Feature
        <span class="relative inline-grid justify-center">
          <span class="col-start-1 row-start-1 text-[hsl(var(--primary))]">Specification</span>
          <span
            aria-hidden="true"
            class="col-start-1 row-start-1 gradient-text"
          >
            Specification
          </span>
        </span>
      </h1>

      <p class="mx-auto max-w-3xl text-xl leading-relaxed text-muted-foreground">
        Detailed documentation of every feature. Completed systems, development in progress, and future planned capabilities. Market your platform before it's built and document it as it grows.
      </p>

      <FeatureStats
        client:visible
        features={sortedFeatures}
        showCompletionPercentage={true}
      />
    </div>
  </section>

  <!-- Completed Features -->
  {completedFeatures.length > 0 && (
    <section class="border-y bg-muted/50 px-4 py-20 sm:px-6 sm:py-24 md:px-8 md:py-32">
      <div class="mx-auto max-w-6xl">
        <div class="mb-16 space-y-4">
          <div class="inline-flex items-center gap-2 rounded-full border border-border/50 bg-green-50 px-3 py-1">
            <CheckCircle2 className="h-4 w-4 text-green-600" />
            <span class="text-sm font-medium text-green-700">Completed & Ready</span>
          </div>
          <h2 class="text-4xl font-bold leading-tight tracking-tight sm:text-5xl">
            Production Features
          </h2>
          <p class="max-w-2xl text-lg leading-relaxed text-muted-foreground">
            Fully implemented, tested, and deployed features powering the ONE Platform.
          </p>
        </div>

        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          {completedFeatures.map((feature) => (
            <FeatureCard feature={feature} showCategory={true} />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- In Development Features -->
  {inDevelopmentFeatures.length > 0 && (
    <section class="px-4 py-20 sm:px-6 sm:py-24 md:px-8 md:py-32">
      <div class="mx-auto max-w-6xl">
        <div class="mb-16 space-y-4">
          <div class="inline-flex items-center gap-2 rounded-full border border-border/50 bg-yellow-50 px-3 py-1">
            <Clock className="h-4 w-4 text-yellow-600" />
            <span class="text-sm font-medium text-yellow-700">Active Development</span>
          </div>
          <h2 class="text-4xl font-bold leading-tight tracking-tight sm:text-5xl">
            In Development
          </h2>
          <p class="max-w-2xl text-lg leading-relaxed text-muted-foreground">
            Features currently being built. See the roadmap, progress, and implementation details.
          </p>
        </div>

        <div class="grid gap-6 md:grid-cols-2">
          {inDevelopmentFeatures.map((feature) => (
            <FeatureCard feature={feature} showCategory={true} />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Planned Features -->
  {plannedFeatures.length > 0 && (
    <section class="border-t bg-muted/50 px-4 py-20 sm:px-6 sm:py-24 md:px-8 md:py-32">
      <div class="mx-auto max-w-6xl">
        <div class="mb-16 space-y-4">
          <div class="inline-flex items-center gap-2 rounded-full border border-border/50 bg-gray-50 px-3 py-1">
            <AlertCircle className="h-4 w-4 text-gray-600" />
            <span class="text-sm font-medium text-gray-700">Coming Soon</span>
          </div>
          <h2 class="text-4xl font-bold leading-tight tracking-tight sm:text-5xl">
            Planned Features
          </h2>
          <p class="max-w-2xl text-lg leading-relaxed text-muted-foreground">
            Future capabilities on the roadmap. Help shape what we build next.
          </p>
        </div>

        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          {plannedFeatures.map((feature) => (
            <FeatureCard feature={feature} showCategory={true} />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- CTA Section -->
  <section class="border-t px-4 py-16 sm:px-6 sm:py-20 md:px-8 md:py-24">
    <div class="mx-auto max-w-4xl text-center space-y-6">
      <h2 class="text-3xl font-bold">Market Your Product Before It's Built</h2>
      <p class="text-lg text-muted-foreground">
        Use this feature specification to share your complete product vision with customers, investors, and team members. Every feature is documented with use cases, ontology mapping, and technical specifications.
      </p>
      <div class="flex flex-wrap justify-center gap-4">
        <a href="/connections">
          <Button variant="outline">View Protocol Specs</Button>
        </a>
        <a href="/docs/features">
          <Button>Feature Documentation</Button>
        </a>
      </div>
    </div>
  </section>
</Layout>
